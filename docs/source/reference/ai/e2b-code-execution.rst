Executing Code Generated by OpenAI Chat Completion Model
========================================================

This section provides an overview on how to use the E2B Sandbox and EvaDB to execute code snippets generated by ChatGPT / Chat Completion Model.

1. Getting a cursor and  Create the E2BExec Function

.. code-block:: python

    import evadb
    cursor = evadb.connect().cursor()
    cursor.query("DROP FUNCTION IF EXISTS E2BExec").execute()
    cursor.query(f"CREATE FUNCTION IF NOT EXISTS E2BExec IMPL '<path>/e2b_exec.py'").execute()

Assume output of OpenAI Chat Completion model has been stored in a table named `CodeToExecute`
under the column `codejson`

The input that this function expects should look like

.. code-block:: json

    {
       "function_call":{
          "name":"exec_code",
          "arguments":"{\n  \"code\": \"def fibonacci(n):\\n    fibonacci_sequence = [0, 1]\\n    while len(fibonacci_sequence) < n:\\n        fibonacci_sequence.append(fibonacci_sequence[-1] + fibonacci_sequence[-2])\\n    return fibonacci_sequence\\n\\nprint(fibonacci(100))\"\n}"
       }
    }

2. Using the following snippet it will execute each column and return stderr and stdout

.. code-block:: python

    result = cursor.query("SELECT E2BExec(codejson) FROM CodeToExecute").execute()

.. note::
    Remember to set your E2B API key as `E2B_API_KEY` environment variable